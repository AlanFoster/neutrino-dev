
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>fork Â· Neutrino</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-npmsearchlist/styles.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../hot/" />
    
    
    <link rel="prev" href="../font-loader/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../installation/">
            
                <a href="../../installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../installation/create-new-project.html">
            
                <a href="../../installation/create-new-project.html">
            
                    
                    Create new project
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../usage.html">
            
                <a href="../../usage.html">
            
                    
                    Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../project-layout.html">
            
                <a href="../../project-layout.html">
            
                    
                    Project Layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../FAQ.html">
            
                <a href="../../FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../learning-resources.html">
            
                <a href="../../learning-resources.html">
            
                    
                    Learning Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../cli/">
            
                <a href="../../cli/">
            
                    
                    CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../api/">
            
                <a href="../../api/">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../webpack-chain.html">
            
                <a href="../../webpack-chain.html">
            
                    
                    Configuration API - webpack-chain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../customization/">
            
                <a href="../../customization/">
            
                    
                    Customization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../creating-presets.html">
            
                <a href="../../creating-presets.html">
            
                    
                    Creating presets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../migration-guide.html">
            
                <a href="../../migration-guide.html">
            
                    
                    Migration Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../../presets/">
            
                <a href="../../presets/">
            
                    
                    Presets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../../presets/community-presets.html">
            
                <a href="../../presets/community-presets.html">
            
                    
                    Community presets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../../middleware/">
            
                <a href="../../middleware/">
            
                    
                    Middleware
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../../middleware/community-middleware.html">
            
                <a href="../../middleware/community-middleware.html">
            
                    
                    Community middleware
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../README.md">
            
                <span>
            
                    
                    Packages
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../web/">
            
                <a href="../web/">
            
                    
                    Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../react/">
            
                <a href="../react/">
            
                    
                    React
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../preact/">
            
                <a href="../preact/">
            
                    
                    Preact
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="../vue/">
            
                <a href="../vue/">
            
                    
                    Vue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="../node/">
            
                <a href="../node/">
            
                    
                    Node.js
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="../library/">
            
                <a href="../library/">
            
                    
                    Library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="../react-components/">
            
                <a href="../react-components/">
            
                    
                    React Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.8" data-path="../airbnb/">
            
                <a href="../airbnb/">
            
                    
                    Airbnb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.9" data-path="../airbnb-base/">
            
                <a href="../airbnb-base/">
            
                    
                    Airbnb Base
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.10" data-path="../standardjs/">
            
                <a href="../standardjs/">
            
                    
                    StandardJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.11" data-path="../karma/">
            
                <a href="../karma/">
            
                    
                    Karma
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.12" data-path="../mocha/">
            
                <a href="../mocha/">
            
                    
                    Mocha
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.13" data-path="../jest/">
            
                <a href="../jest/">
            
                    
                    Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.14" data-path="../babel-minify/">
            
                <a href="../babel-minify/">
            
                    
                    babel-minify
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.15" data-path="../banner/">
            
                <a href="../banner/">
            
                    
                    banner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.16" data-path="../chunk/">
            
                <a href="../chunk/">
            
                    
                    chunk
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.17" data-path="../clean/">
            
                <a href="../clean/">
            
                    
                    clean
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.18" data-path="../compile-loader/">
            
                <a href="../compile-loader/">
            
                    
                    compile-loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.19" data-path="../copy/">
            
                <a href="../copy/">
            
                    
                    copy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.20" data-path="../dev-server/">
            
                <a href="../dev-server/">
            
                    
                    dev-server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.21" data-path="../env/">
            
                <a href="../env/">
            
                    
                    env
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.22" data-path="../eslint/">
            
                <a href="../eslint/">
            
                    
                    eslint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.23" data-path="../font-loader/">
            
                <a href="../font-loader/">
            
                    
                    font-loader
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.15.24" data-path="./">
            
                <a href="./">
            
                    
                    fork
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.25" data-path="../hot/">
            
                <a href="../hot/">
            
                    
                    hot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.26" data-path="../html-loader/">
            
                <a href="../html-loader/">
            
                    
                    html-loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.27" data-path="../html-template/">
            
                <a href="../html-template/">
            
                    
                    html-template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.28" data-path="../image-loader/">
            
                <a href="../image-loader/">
            
                    
                    image-loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.29" data-path="../image-minify/">
            
                <a href="../image-minify/">
            
                    
                    image-minify
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.30" data-path="../loader-merge/">
            
                <a href="../loader-merge/">
            
                    
                    loader-merge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.31" data-path="../minify/">
            
                <a href="../minify/">
            
                    
                    minify
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.32" data-path="../pwa/">
            
                <a href="../pwa/">
            
                    
                    pwa
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.33" data-path="../start-server/">
            
                <a href="../start-server/">
            
                    
                    start-server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.34" data-path="../style-loader/">
            
                <a href="../style-loader/">
            
                    
                    style-loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.35" data-path="../style-minify/">
            
                <a href="../style-minify/">
            
                    
                    style-minify
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.36" data-path="../stylelint/">
            
                <a href="../stylelint/">
            
                    
                    stylelint
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
                <a target="_blank" href="https://github.com/mozilla-neutrino/neutrino-dev/tree/docs-v6/docs">
            
                    
                    v6 Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" >
            
                <a target="_blank" href="https://github.com/mozilla-neutrino/neutrino-dev/tree/docs-v5/docs">
            
                    
                    v5 Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
                <a target="_blank" href="https://github.com/mozilla-neutrino/neutrino-dev/tree/docs-v4/docs">
            
                    
                    v4 Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../../contributing/">
            
                <a href="../../contributing/">
            
                    
                    Contributing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1" data-path="../../contributing/development.html">
            
                <a href="../../contributing/development.html">
            
                    
                    Development Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2" data-path="../../contributing/code-of-conduct.html">
            
                <a href="../../contributing/code-of-conduct.html">
            
                    
                    Code of Conduct
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >fork</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="neutrino-fork-middleware">Neutrino Fork Middleware</h1>
<p><code>@neutrinojs/fork</code> is Neutrino middleware for forking the usage of other middleware into separate processes.
You can combine this with other middleware to configure and build multiple project types from a single project.</p>
<p><a href="https://npmjs.org/package/@neutrinojs/fork" target="_blank"><img src="https://img.shields.io/npm/v/@neutrinojs/fork.svg" alt="NPM version"></a>
<a href="https://npmjs.org/package/@neutrinojs/fork" target="_blank"><img src="https://img.shields.io/npm/dt/@neutrinojs/fork.svg" alt="NPM downloads"></a>
<a href="https://spectrum.chat/neutrino" target="_blank"><img src="https://withspectrum.github.io/badge/badge.svg" alt="Join the Neutrino community on Spectrum"></a></p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Node.js v6 LTS, v8, v9</li>
<li>Yarn v1.2.1+, or npm v5.4+</li>
<li>Neutrino v8</li>
</ul>
<h2 id="installation">Installation</h2>
<p><code>@neutrinojs/fork</code> can be installed via the Yarn or npm clients. Inside your project, make sure you have
<code>neutrino</code> installed and any other Neutrino middleware are development dependencies.</p>
<h4 id="yarn">Yarn</h4>
<pre class="language-"><code class="lang-bash">&#x276F; yarn add --dev @neutrinojs/fork
</code></pre>
<h4 id="npm">npm</h4>
<pre class="language-"><code class="lang-bash">&#x276F; <span class="token function">npm</span> <span class="token function">install</span> --save-dev @neutrinojs/fork
</code></pre>
<h2 id="details">Details</h2>
<p><code>@neutrinojs/fork</code> operates by defining which middleware you wish to split off into separate processes so they
can be run simultaneously. Some typical use cases:</p>
<ul>
<li>Building a web app and a Node.js app from the same project</li>
<li>Build multiple web apps or multiple Node.js apps from the same project</li>
<li>Generate multiple targets when building libraries</li>
</ul>
<p><em>This middleware must be used in conjunction with a <code>.neutrinorc.js</code> file to inform Neutrino of which
middleware should be split into another process. See the <a href="../../customization">customization docs</a>
for details on setting up a <code>.neutrinorc.js</code> file in your project if you do not already have one.</em></p>
<p><em>Important: The configuration options provided to the fork middleware needs to be serializable across
Node.js processes, which is includes Strings, Numbers, Arrays, Booleans, Objects, Arrays, and more. Using
functions or class instances may not be serializable across processes, such as is the case with some
webpack plugins. If you need to provide these to fork middleware configuration, see the section on serialization
workarounds below.</em></p>
<h2 id="quickstart">Quickstart</h2>
<p>After installing Neutrino, your other build middleware, and the fork middleware, open your <code>.neutrinorc.js</code> file.
For this example, let&apos;s demonstrate building a React app and Node.js app from the same project using different source
directories:</p>
<pre class="language-"><code class="lang-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/fork&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      configs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        react<span class="token punctuation">:</span> <span class="token string">&apos;@neutrinojs/react&apos;</span><span class="token punctuation">,</span>
        node<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span> source<span class="token punctuation">:</span> <span class="token string">&apos;server&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/node&apos;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Let&apos;s examine this <code>.neutrinorc.js</code> file and see what is happening:</p>
<pre class="language-"><code class="lang-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// Tell Neutrino to use the following middleware defined</span>
  <span class="token comment" spellcheck="true">// in this array</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">// Use the fork middleware to build configuration</span>
    <span class="token comment" spellcheck="true">// into separate processes.</span>
    <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/fork&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Each process will be defined in &quot;configs&quot;.</span>
      <span class="token comment" spellcheck="true">// The key in &quot;configs&quot; will be used to identify</span>
      <span class="token comment" spellcheck="true">// the forked process. For simplicity, we named</span>
      <span class="token comment" spellcheck="true">// these &quot;react&quot; and &quot;node&quot;. Therefore, these 2</span>
      <span class="token comment" spellcheck="true">// will spawn 2 separate processes, one for the</span>
      <span class="token comment" spellcheck="true">// &quot;react&quot; config, and one for the &quot;node&quot; config.</span>
      configs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// The key in &quot;configs&quot; maps to a middleware value.</span>

        <span class="token comment" spellcheck="true">// The &quot;react&quot; config uses &quot;@neutrinojs/react&quot; as</span>
        <span class="token comment" spellcheck="true">// middleware using the string format. By default,</span>
        <span class="token comment" spellcheck="true">// the &quot;react&quot; app&apos;s source lives in src/, and builds</span>
        <span class="token comment" spellcheck="true">// to build/</span>
        react<span class="token punctuation">:</span> <span class="token string">&apos;@neutrinojs/react&apos;</span><span class="token punctuation">,</span>

        <span class="token comment" spellcheck="true">// The &quot;node&quot; config uses the object middleware</span>
        <span class="token comment" spellcheck="true">// format to configure Neutrino to build this</span>
        <span class="token comment" spellcheck="true">// project from a different directory than the</span>
        <span class="token comment" spellcheck="true">// &quot;react&quot; app, using server/ instead of src/, and</span>
        <span class="token comment" spellcheck="true">// builds to server-build/</span>
        node<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span> source<span class="token punctuation">:</span> <span class="token string">&apos;server&apos;</span><span class="token punctuation">,</span> output<span class="token punctuation">:</span> <span class="token string">&apos;server-build&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/node&apos;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Upon starting or building your project, you will now see console messages labeled according to their config ID,
each running in their own process. Quitting Neutrino will cause all forked processes to exit.</p>
<pre class="language-"><code class="lang-bash">&#x276F; yarn start
<span class="token punctuation">[</span>react<span class="token punctuation">]</span> &#x2714; Development server running on: http://localhost:5000
<span class="token punctuation">[</span>node<span class="token punctuation">]</span> Listening on :3000
<span class="token punctuation">[</span>node<span class="token punctuation">]</span> &#x2714; Build completed
<span class="token punctuation">[</span>react<span class="token punctuation">]</span> &#x2714; Build completed
</code></pre>
<h2 id="paths">Paths</h2>
<p>Most middleware attempt to follow the standard <a href="../../project-layout">Neutrino project layout</a>
to output their compiled output, but building multiple projects at once is bound to cause clashes with
the directories each project uses. This could lead to:</p>
<ul>
<li>One target cleaning the output of another target</li>
<li>One target replacing a file from the output of another target</li>
</ul>
<p>This has the potential to lead to difficult bugs. As such, it is recommended to change the source and output directory
options to avoid this situation altogether, which the example above demonstrates. If you are certain you want from
and to the same directories, such as when building libraries, ensure you follow any project cleanup instructions
outlined by your middleware.</p>
<h2 id="serialization">Serialization</h2>
<p>The configuration options provided to the fork middleware needs to be serializable across
Node.js processes, which is includes Strings, Numbers, Arrays, Booleans, Objects, Arrays, and more. Using
functions or class instances may not be serializable across processes, such as is the case with some
webpack plugins.</p>
<p>For example, let&apos;s say you wanted to consume the <code>webpack-assets-plugin</code> in your fork middleware options:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// .neutrinorc.js</span>
<span class="token keyword">const</span> AssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;assets-webpack-plugin&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/fork&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      configs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        react<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">&apos;@neutrinojs/react&apos;</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>neutrino<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
              neutrino<span class="token punctuation">.</span>config
                <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&apos;asset&apos;</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>AssetsPlugin<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token comment" spellcheck="true">/* ... */</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>This would not work as-is, since the middleware function consuming the <code>AssetsPlugin</code> would not be serializable as-is.
To work around this, you can move this middleware function to a separate file, and reference it in the middleware,
which would then get forked and used:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// .neutrinorc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/fork&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      configs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        react<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">&apos;@neutrinojs/react&apos;</span><span class="token punctuation">,</span>
            <span class="token string">&apos;assets-middleware.js&apos;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// assets-middleware.js</span>
<span class="token keyword">const</span> AssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;assets-webpack-plugin&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>neutrino<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  neutrino<span class="token punctuation">.</span>config
    <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&apos;asset&apos;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>AssetsPlugin<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token comment" spellcheck="true">/* ... */</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="events">Events</h2>
<p>The fork middleware creates a new instance of the Neutrino API for every process spawned.
In order to make use of the Neutrino events that occur in these sub-processes from the parent, Neutrino maps
these events using a <code>{name}:{event}</code> convention:</p>
<pre class="language-"><code class="lang-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/fork&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      configs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        react<span class="token punctuation">:</span> <span class="token string">&apos;@neutrinojs/react&apos;</span><span class="token punctuation">,</span>
        node<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span> source<span class="token punctuation">:</span> <span class="token string">&apos;server&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;@neutrinojs/node&apos;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment" spellcheck="true">// listen for certain events</span>
    <span class="token punctuation">(</span>neutrino<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      neutrino<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;react:build&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      neutrino<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;node:start&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="contributing">Contributing</h2>
<p>This preset is part of the <a href="https://github.com/mozilla-neutrino/neutrino-dev" target="_blank">neutrino-dev</a> repository, a monorepo
containing all resources for developing Neutrino and its core presets and middleware. Follow the
<a href="../../contributing">contributing guide</a> for details.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../font-loader/" class="navigation navigation-prev " aria-label="Previous page: font-loader">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../hot/" class="navigation navigation-next " aria-label="Next page: hot">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"fork","level":"1.15.24","depth":2,"next":{"title":"hot","level":"1.15.25","depth":2,"path":"packages/hot/README.md","ref":"./packages/hot/README.md","articles":[]},"previous":{"title":"font-loader","level":"1.15.23","depth":2,"path":"packages/font-loader/README.md","ref":"./packages/font-loader/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["edit-link","prism","-highlight","github","anchorjs","npmsearchlist"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"github":{"url":"https://github.com/mozilla-neutrino/neutrino-dev/"},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"npmsearchlist":{},"fontsettings":{"theme":"white","family":"sans","size":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit page","base":"https://github.com/mozilla-neutrino/neutrino-dev/tree/master/docs"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchorjs":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Neutrino","gitbook":"*"},"file":{"path":"packages/fork/README.md","mtime":"2018-03-10T16:38:32.078Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-03-22T18:42:32.314Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-npmsearchlist/script.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

